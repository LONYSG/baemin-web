<!DOCTYPE html>
<html lang="en" xmlns:th="http://www.thymeleaf.org">

<th:block th:replace="~{/layout/basic :: setContent(~{this::content} )}">

    <th:block th:fragment="content">

        <h2 class="line">

            <h1 class="mt-4">리뷰 쓰기</h1>


            <form id="reviewForm" class="re" th:action="@{/review/register}" th:method="post">

                <input class="rene" type="hidden" id="order_id" th:value="${review.order_id}" name="order_id"
                       readonly><br>

                <div class="form-group">
                    <label>음식은 어떠셨어요?</label>
                    <div class='starrr'></div>

                    <script th:src="@{/starrr.js}"></script>
                    <link th:href="@{/css/starrr.css}" rel="stylesheet">
                    <link rel="stylesheet"
                          href="http://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.2.0/css/font-awesome.min.css">

                    <script>
                        $(document).ready(function (e) {

                            var rating = 0;

                            $('.starrr').starrr({
                                rating: rating,
                                change: function (e, value) {
                                    if (value) {
                                        console.log(value);
                                        rating = value;
                                        $("#rating").val(rating);
                                    }
                                }
                            });

                            //modify rating
                            // var rating = targetReview.find('.card-title span').html();
                            // $(".starrr a:nth-child(" + rating + ")").trigger('click');

                        });
                    </script>


                    <input type="hidden" id="rating" name="rating">


                </div>

                <div class="form-group fileForm">
                    <label class="con">[[${review.store_name}]]</label>
                    <div class="custom-file">
                        <textarea name="content" style="width:100%; height:100px"
                                  placeholder="음식의 맛, 양, 포장 상태 등 음식에 대한 솔직한 리뷰를 남겨주세요.(선택)"></textarea>
                    </div>
                </div>


                <div class="form-group fileForm">
                    <label class="sajin">사진 첨부</label>
                    <div class="custom-file">
                        <input type="file" class="custom-file-input files" id="fileInput"
                               name="reviewPictureList[0].picture_url" multiple>
                        <label class="custom-file-label" data-browse="첨부하기"></label>
                    </div>
                </div>

                <div class="box">

                </div>

                <style>
                    .uploadResult {
                        width: 100%;
                        background-color: gray;
                        margin-top: 10px;
                    }

                    .uploadResult ul {
                        display: flex;
                        flex-flow: row;
                        justify-content: center;
                        align-items: center;
                        vertical-align: top;
                        overflow: auto;
                    }

                    .uploadResult ul li {
                        list-style: none;
                        padding: 10px;
                        margin-left: 2em;
                    }

                    .uploadResult ul li img {
                        width: 100px;
                    }
                </style>

                <a class="wan"><button type="button" class="btn btn-primary registerBtn">완료</button></a>

            </form>

            <script>
                // Add the following code if you want the name of the file appear on select
                $(".custom-file-input").on("change", function () {
                    var fileName = $(this).val().split("\\").pop();
                    $(this).siblings(".custom-file-label").addClass("selected").html(fileName);
                });
            </script>

            <script>
                function showResult(uploadResultArr) {

                    var uploadUL = $(".uploadResult ul");

                    var str = "";

                    $(uploadResultArr).each(function (i, obj) {

                        str += "<li data-name='" + obj.fileName + "' data-path='" + obj.folderPath + "' data-uuid='" + obj.uuid + "'>";
                        str + " <div>";
                        str += "<button type='button' data-file=\'" + obj.imageURL + "\' "
                        str += "class='btn-warning btn-sm'>X</button><br>";
                        str += "<img src='/display?fileName=" + obj.thumbnailURL + "'>";
                        str += "</div>";
                        str + "</li>";
                    });

                    uploadUL.append(str);
                }

                $(".uploadResult ").on("click", "li button", function (e) {

                    console.log("delete file");

                    var targetFile = $(this).data("file");

                    var targetLi = $(this).closest("li");

                    $.ajax({
                        url: '/removeFile',
                        data: { fileName: targetFile },
                        dataType: 'text',
                        type: 'POST',
                        success: function (result) {
                            alert(result);

                            targetLi.remove();
                        }
                    }); //$.ajax
                });

                $(".registerBtn").click(function () {
                    if ($("input[name=rating]").val() != "") {
                        $("#reviewForm").submit();
                    } else{
                        alert("별점을 매겨주세요.")
                        return;
                    }

                });

            </script>

        </h2>

    </th:block>

</th:block>